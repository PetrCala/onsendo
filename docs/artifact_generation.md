# Database Artifact Generation

This document describes the database artifacts generated by the `onsendo system update-artifacts` command and how they are created.

## Overview

The `update-artifacts` command generates static database files in the `artifacts/db/` folder for presentation purposes. These artifacts are created without affecting the current working database by using a backup/restore mechanism.

## Generated Artifacts

### 1. `onsen_empty.db`

- **Description**: Empty database with all tables created but no data
- **Size**: ~28KB
- **Generation Method**:
  - Creates new SQLite database file
  - Runs `CREATE TABLE` statements for all models
  - No data import

### 2. `onsen_no_visits_no_locations.db`

- **Description**: Database populated with onsen data from latest scraping, but no visits or locations
- **Size**: ~108KB
- **Generation Method**:
  - Creates empty database
  - Imports onsen data from latest `artifacts/scraping/*scraped_onsen_data*.json` file
  - No visits or locations added

### 3. `onsen_with_locations.db`

- **Description**: Database with onsen data plus locations from artifacts
- **Size**: ~108KB
- **Generation Method**:
  - Creates empty database
  - Imports onsen data from latest scraping
  - Adds locations from `artifacts/locations/locations.json` file
  - No visits added

### 4. `onsen_latest.db`

- **Description**: Copy of the current working database state
- **Size**: Varies based on current database content
- **Generation Method**:
  - Direct copy of current `data/db/onsen.db` file
  - If no current database exists, creates empty one

## Artifact Generation Process

The `update-artifacts` command follows this sequence:

1. **Backup Current Database**: Creates temporary backup of current working database
2. **Generate Artifacts**: Creates each artifact in sequence
3. **Restore Current Database**: Restores the working database from backup

This ensures the current database is never modified during artifact generation.

## File Dependencies

### Required Files

- `artifacts/scraping/*scraped_onsen_data*.json` - Latest scraped onsen data
- `artifacts/locations/locations.json` - Location definitions

### Generated Files

- `artifacts/db/onsen_empty.db`
- `artifacts/db/onsen_no_visits_no_locations.db`
- `artifacts/db/onsen_with_locations.db`
- `artifacts/db/onsen_latest.db`

## Usage

```bash
# Generate all artifacts
onsendo system update-artifacts

# View system command help
onsendo system --help
```

## Future Enhancements

The system is designed to be easily extensible:

- **Adding New Artifacts**: Add new generation methods to the `ArtifactGenerator` class
- **Modifying Generation Steps**: Update individual methods to change how artifacts are created
- **Location Artifacts**: Currently uses placeholder functionality that can be enhanced to read from more sophisticated location artifact files
- **Visit Data**: Future versions could include artifacts with sample visit data

## Implementation Details

The artifact generation is implemented in `src/cli/commands/system/update_artifacts.py` with the following key components:

- `ArtifactGenerator` class that handles all artifact creation
- Backup/restore mechanism for database safety
- Reuse of existing database import logic (`src.db.import_data`)
- Configurable artifact definitions for easy maintenance
